<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lapor Suara Hati - Platform Curhat Anonim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#06b6d4',
                        accent: '#10b981',
                        warm: '#f59e0b',
                        soft: '#f3f4f6'
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCsILfVLWQVAMtxztk1Tiuf_9O-6nkAClw",
            authDomain: "curhat-683b7.firebaseapp.com",
            databaseURL: "https://curhat-683b7-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "curhat-683b7",
            storageBucket: "curhat-683b7.firebasestorage.app",
            messagingSenderId: "20934105786",
            appId: "1:20934105786:web:35da04b6df4b722d348083"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // Make firebase available globally
        window.firebase = { database, ref, push, onValue, serverTimestamp, increment };
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #6b7280;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-white/20 p-2 rounded-full">
                        <i class="fas fa-heart text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Lapor Suara Hati</h1>
                        <p class="text-sm opacity-90">Platform Curhat Anonim</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <a href="#beranda" class="hover:text-yellow-200 transition-colors">Beranda</a>
                    <a href="#curhat" class="hover:text-yellow-200 transition-colors">Curhat</a>
                    <a href="#bantuan" class="hover:text-yellow-200 transition-colors">Bantuan</a>
                    <a href="#tentang" class="hover:text-yellow-200 transition-colors">Tentang</a>
                </nav>
                <button class="md:hidden text-white">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="beranda" class="py-16 bg-gradient-to-r from-blue-50 to-indigo-100">
        <div class="container mx-auto px-4 text-center">
            <div class="max-w-4xl mx-auto">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/703f3a65-c524-4443-9d58-1fa0b9e06519.png" alt="Warm illustration of diverse people sitting in a circle sharing stories with soft lighting and peaceful atmosphere" class="mx-auto mb-8 rounded-lg shadow-lg" />
                <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">
                    Tempat Aman untuk <span class="text-primary">Bercerita</span>
                </h2>
                <p class="text-xl text-gray-600 mb-8 leading-relaxed">
                    Bagikan beban hatimu, dapatkan dukungan dari komunitas yang peduli. 
                    Semua anonim, semua aman, semua saling membantu.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="showCurhatForm()" class="bg-primary text-white px-8 py-4 rounded-full font-semibold hover:bg-indigo-700 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-pen mr-2"></i>Mulai Curhat
                    </button>
                    <button onclick="scrollToFeed()" class="bg-white text-primary border-2 border-primary px-8 py-4 rounded-full font-semibold hover:bg-primary hover:text-white transition-all">
                        <i class="fas fa-comments mr-2"></i>Lihat Cerita Lain
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8 text-center">
                <div class="fade-in">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-users text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="userCount">2,847</h3>
                    <p class="text-gray-600">Pengguna Aktif</p>
                </div>
                <div class="fade-in">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-comment-alt text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="storyCount">15,632</h3>
                    <p class="text-gray-600">Cerita Dibagikan</p>
                </div>
                <div class="fade-in">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-heart text-purple-600 text-2xl"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="supportCount">48,291</h3>
                    <p class="text-gray-600">Dukungan Diberikan</p>
                </div>
                <div class="fade-in">
                    <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-smile text-yellow-600 text-2xl"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800" id="helpCount">9,876</h3>
                    <p class="text-gray-600">Solusi Ditemukan</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Curhat Form Section -->
    <section id="curhat" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="max-w-3xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Bagikan Suara Hatimu</h2>
                    <p class="text-gray-600">Ceritakan apa yang ada di hatimu. Identitasmu akan selalu terjaga.</p>
                </div>

                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <form id="curhatForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kategori Cerita</label>
                            <select id="categorySelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <option value="">Pilih kategori...</option>
                                <option value="keluarga">Masalah Keluarga</option>
                                <option value="percintaan">Percintaan</option>
                                <option value="karir">Karir & Pekerjaan</option>
                                <option value="kesehatan">Kesehatan Mental</option>
                                <option value="persahabatan">Persahabatan</option>
                                <option value="keuangan">Keuangan</option>
                                <option value="pendidikan">Pendidikan</option>
                                <option value="lainnya">Lainnya</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Judul Cerita</label>
                            <input id="titleInput" type="text" placeholder="Berikan judul untuk ceritamu..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required />
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ceritakan Masalahmu</label>
                            <textarea id="storyTextarea" rows="6" placeholder="Tulis ceritamu dengan bebas. Jangan takut untuk mengekspresikan perasaanmu..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent resize-none" required></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Apa yang Kamu Butuhkan?</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" value="dukungan-emosional" class="need-checkbox mr-3 rounded text-primary">
                                    <span>Dukungan emosional</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="saran-solusi" class="need-checkbox mr-3 rounded text-primary">
                                    <span>Saran dan solusi</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="pengalaman-serupa" class="need-checkbox mr-3 rounded text-primary">
                                    <span>Berbagi pengalaman serupa</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="didengarkan" class="need-checkbox mr-3 rounded text-primary">
                                    <span>Hanya ingin didengarkan</span>
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-primary text-white py-4 rounded-lg font-semibold hover:bg-indigo-700 transition-all transform hover:scale-[1.02]">
                            <i class="fas fa-paper-plane mr-2"></i>Bagikan Cerita
                        </button>

                        <p class="text-sm text-gray-500 text-center">
                            <i class="fas fa-shield-alt mr-1"></i>
                            Ceritamu akan dibagikan secara anonim dan aman
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Filter Section -->
    <section class="py-8 bg-white border-b">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap gap-4 justify-center items-center">
                <span class="font-medium text-gray-700">Filter Cerita:</span>
                <button onclick="filterStories('all')" class="filter-btn active px-4 py-2 rounded-full bg-primary text-white text-sm">Semua</button>
                <button onclick="filterStories('keluarga')" class="filter-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 text-sm hover:bg-gray-300">Keluarga</button>
                <button onclick="filterStories('percintaan')" class="filter-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 text-sm hover:bg-gray-300">Percintaan</button>
                <button onclick="filterStories('karir')" class="filter-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 text-sm hover:bg-gray-300">Karir</button>
                <button onclick="filterStories('kesehatan')" class="filter-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 text-sm hover:bg-gray-300">Kesehatan Mental</button>
                <button onclick="filterStories('persahabatan')" class="filter-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 text-sm hover:bg-gray-300">Persahabatan</button>
            </div>
        </div>
    </section>

    <!-- Stories Feed -->
    <section id="stories" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Cerita dari Komunitas</h2>
                <p class="text-gray-600">Baca, berikan dukungan, dan bantu sesama</p>
            </div>

            <div id="storiesFeed" class="max-w-4xl mx-auto space-y-8">
                <!-- Loading indicator -->
                <div id="loadingIndicator" class="text-center py-12">
                    <div class="inline-flex items-center px-6 py-3 bg-white rounded-lg shadow-lg">
                        <i class="fas fa-spinner fa-spin mr-3 text-primary"></i>
                        <span class="text-gray-600">Memuat cerita...</span>
                    </div>
                </div>
                
                <!-- Stories will be loaded here dynamically -->
            </div>

            <!-- Load More Button -->
            <div class="text-center mt-12">
                <button onclick="loadMoreStories()" class="bg-white text-primary border-2 border-primary px-8 py-3 rounded-full font-semibold hover:bg-primary hover:text-white transition-all">
                    <i class="fas fa-arrow-down mr-2"></i>Muat Lebih Banyak Cerita
                </button>
            </div>
        </div>
    </section>

    <!-- Support Section -->
    <section id="bantuan" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Cara Memberikan Dukungan</h2>
                <p class="text-gray-600">Panduan untuk menjadi bagian dari komunitas yang peduli</p>
            </div>

            <div class="max-w-5xl mx-auto grid md:grid-cols-3 gap-8">
                <div class="text-center p-6 rounded-2xl bg-gradient-to-b from-blue-50 to-white border border-blue-100">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/0be129fa-5950-4171-8513-46d74333d5e6.png" alt="Gentle hands offering support with warm lighting and compassionate gesture" class="mx-auto mb-4 rounded-lg" />
                    <h3 class="text-xl font-bold text-gray-800 mb-3">Dengarkan dengan Empati</h3>
                    <p class="text-gray-600">
                        Baca cerita dengan penuh perhatian. Pahami perasaan yang sedang dialami penulis 
                        dan berikan respon yang menunjukkan empati.
                    </p>
                </div>

                <div class="text-center p-6 rounded-2xl bg-gradient-to-b from-green-50 to-white border border-green-100">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/42c425a1-c9e1-4099-9baa-518ec162dd73.png" alt="People sharing wisdom and advice in a comfortable setting with soft natural lighting" class="mx-auto mb-4 rounded-lg" />
                    <h3 class="text-xl font-bold text-gray-800 mb-3">Berikan Saran Konstruktif</h3>
                    <p class="text-gray-600">
                        Bagikan pengalaman atau saran yang bermanfaat. Hindari menghakimi dan 
                        fokuslah pada solusi yang membangun.
                    </p>
                </div>

                <div class="text-center p-6 rounded-2xl bg-gradient-to-b from-purple-50 to-white border border-purple-100">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9a690913-8cd3-4328-ab60-34bba424b73d.png" alt="Safe space symbol with protective elements and calming atmosphere representing trust and security" class="mx-auto mb-4 rounded-lg" />
                    <h3 class="text-xl font-bold text-gray-800 mb-3">Jaga Privasi</h3>
                    <p class="text-gray-600">
                        Hormati anonimitas setiap pengguna. Jangan mencoba menebak identitas 
                        atau meminta informasi pribadi.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="tentang" class="py-16 bg-gradient-to-b from-gray-50 to-white">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Tentang Lapor Suara Hati</h2>
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/142bf4de-aacf-4e24-8621-7a4f59dbfb60.png" alt="Digital community illustration showing diverse people connected through technology with warm colors and inclusive design representing online support network" class="mx-auto mb-8 rounded-lg shadow-lg" />
                <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                    Lapor Suara Hati adalah platform digital yang dirancang khusus untuk memberikan ruang aman 
                    bagi siapa saja yang ingin berbagi beban hidup, mencari dukungan, dan saling membantu dalam 
                    komunitas yang peduli. Kami percaya bahwa setiap orang berhak mendapatkan dukungan emosional 
                    tanpa takut dihakimi.
                </p>

                <div class="grid md:grid-cols-3 gap-8 mt-12">
                    <div class="p-6">
                        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-shield-alt text-blue-600 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-3">100% Anonim</h3>
                        <p class="text-gray-600">Identitas kamu sepenuhnya terlindungi dan tidak akan pernah dibagikan kepada siapapun.</p>
                    </div>

                    <div class="p-6">
                        <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-clock text-green-600 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-3">24/7 Tersedia</h3>
                        <p class="text-gray-600">Platform ini selalu terbuka kapan saja kamu membutuhkan tempat untuk bercerita.</p>
                    </div>

                    <div class="p-6">
                        <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-hands-helping text-purple-600 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-3">Komunitas Peduli</h3>
                        <p class="text-gray-600">Bergabung dengan ribuan orang yang siap mendengarkan dan memberikan dukungan.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="bg-white/20 p-2 rounded-full">
                            <i class="fas fa-heart text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold">Lapor Suara Hati</h3>
                        </div>
                    </div>
                    <p class="text-white/80 mb-4">
                        Platform curhat anonim yang aman dan peduli untuk membantu sesama.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-white/60 hover:text-white text-xl"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-white/60 hover:text-white text-xl"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white/60 hover:text-white text-xl"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold mb-4">Kategori Populer</h4>
                    <ul class="space-y-2 text-white/80">
                        <li><a href="#" class="hover:text-white transition-colors">Percintaan</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Keluarga</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Karir</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Kesehatan Mental</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4">Bantuan</h4>
                    <ul class="space-y-2 text-white/80">
                        <li><a href="#" class="hover:text-white transition-colors">Cara Menggunakan</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Panduan Komunitas</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">FAQ</a></li>
                        <li><a href="#" class="hover:text-white transition-colors">Kontak</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4">Darurat</h4>
                    <p class="text-white/80 mb-4">Jika kamu sedang dalam krisis, segera hubungi:</p>
                    <div class="space-y-2 text-sm">
                        <p class="bg-white/20 p-2 rounded">Hotline Jiwa: 0838-7463-6450</p>
                        <p class="bg-white/20 p-2 rounded">Crisis Center: 0877-5690-9678</p>
                    </div>
                </div>
            </div>

            <div class="border-t border-white/20 mt-8 pt-8 text-center text-white/60">
                <p>Â© 2025 Lapor Suara Hati. Dibuat dengan cinta oleh andri14.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let allStories = [];
        let currentFilter = 'all';
        
        // Firebase functions (wait for initialization)
        let database, ref, push, onValue, serverTimestamp, increment;

        // Initialize Firebase functionality after DOM load
        window.addEventListener('load', () => {
            // Wait for Firebase to be available
            const initFirebase = () => {
                if (window.firebase) {
                    database = window.firebase.database;
                    ref = window.firebase.ref;
                    push = window.firebase.push;
                    onValue = window.firebase.onValue;
                    serverTimestamp = window.firebase.serverTimestamp;
                    increment = window.firebase.increment;
                    
                    // Initialize app
                    loadStories();
                    updateStats();
                    
                    animateCounter(document.getElementById('userCount'), 2847);
                    animateCounter(document.getElementById('storyCount'), 15632);
                    animateCounter(document.getElementById('supportCount'), 48291);
                    animateCounter(document.getElementById('helpCount'), 9876);
                } else {
                    setTimeout(initFirebase, 100);
                }
            };
            initFirebase();
        });

        // Counter Animation
        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 100;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current).toLocaleString();
            }, 20);
        }

        // Load stories from Firebase
        function loadStories() {
            const storiesRef = ref(database, 'stories');
            onValue(storiesRef, (snapshot) => {
                const data = snapshot.val();
                allStories = [];
                
                if (data) {
                    Object.keys(data).forEach(key => {
                        allStories.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    
                    // Sort by timestamp (newest first)
                    allStories.sort((a, b) => b.timestamp - a.timestamp);
                }
                
                displayStories();
                document.getElementById('loadingIndicator').style.display = 'none';
            });
        }

        // Display stories in the feed
        function displayStories() {
            const feed = document.getElementById('storiesFeed');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            // Clear existing stories (except loading indicator)
            const existingStories = feed.querySelectorAll('.story-card');
            existingStories.forEach(story => story.remove());
            
            if (allStories.length === 0) {
                const noStories = document.createElement('div');
                noStories.className = 'text-center py-12 text-gray-500';
                noStories.innerHTML = `
                    <div class="bg-white p-8 rounded-lg shadow-lg">
                        <i class="fas fa-heart text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">Belum ada cerita</h3>
                        <p>Jadilah yang pertama membagikan cerita!</p>
                    </div>
                `;
                feed.appendChild(noStories);
                return;
            }

            const filteredStories = currentFilter === 'all' 
                ? allStories 
                : allStories.filter(story => story.category === currentFilter);

            filteredStories.forEach(story => {
                const storyElement = createStoryElement(story);
                feed.appendChild(storyElement);
            });
        }

        // Create story element
        function createStoryElement(story) {
            const article = document.createElement('article');
            article.className = 'story-card bg-white rounded-2xl shadow-lg p-6 card-hover fade-in';
            article.setAttribute('data-category', story.category);
            article.setAttribute('data-story-id', story.id);

            const categoryColors = {
                'keluarga': 'bg-blue-100 text-blue-700',
                'percintaan': 'bg-pink-100 text-pink-700',
                'karir': 'bg-green-100 text-green-700',
                'kesehatan': 'bg-purple-100 text-purple-700',
                'persahabatan': 'bg-yellow-100 text-yellow-700',
                'keuangan': 'bg-indigo-100 text-indigo-700',
                'pendidikan': 'bg-red-100 text-red-700',
                'lainnya': 'bg-gray-100 text-gray-700'
            };

            const categoryLabels = {
                'keluarga': 'Keluarga',
                'percintaan': 'Percintaan',
                'karir': 'Karir',
                'kesehatan': 'Kesehatan Mental',
                'persahabatan': 'Persahabatan',
                'keuangan': 'Keuangan',
                'pendidikan': 'Pendidikan',
                'lainnya': 'Lainnya'
            };

            const timeAgo = getTimeAgo(story.timestamp);
            const needsHtml = story.needs ? story.needs.map(need => {
                const needLabels = {
                    'dukungan-emosional': 'Dukungan emosional',
                    'saran-solusi': 'Saran dan solusi',
                    'pengalaman-serupa': 'Pengalaman serupa',
                    'didengarkan': 'Ingin didengarkan'
                };
                return `<span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">${needLabels[need] || need}</span>`;
            }).join('') : '';

            article.innerHTML = `
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-gradient-to-r from-pink-400 to-purple-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <span class="text-sm ${categoryColors[story.category] || categoryColors.lainnya} px-3 py-1 rounded-full">
                                ${categoryLabels[story.category] || 'Lainnya'}
                            </span>
                            <p class="text-sm text-gray-500 mt-1">${timeAgo}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                        <i class="fas fa-heart text-red-400"></i>
                        <span class="likes-count">${story.likes || 0}</span>
                        <i class="fas fa-comment ml-2"></i>
                        <span class="comments-count">${story.commentsCount || 0}</span>
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-gray-800 mb-3">${story.title}</h3>
                <p class="text-gray-600 mb-4 leading-relaxed">${story.content}</p>

                <div class="flex flex-wrap gap-2 mb-4">
                    ${needsHtml}
                </div>

                <div class="flex items-center justify-between pt-4 border-t">
                    <div class="flex space-x-4">
                        <button onclick="likeStory('${story.id}', this)" class="flex items-center space-x-1 text-gray-600 hover:text-red-500 transition-colors">
                            <i class="far fa-heart"></i>
                            <span>Dukung</span>
                        </button>
                        <button onclick="toggleComments(this)" class="flex items-center space-x-1 text-gray-600 hover:text-blue-500 transition-colors">
                            <i class="far fa-comment"></i>
                            <span>Balas</span>
                        </button>
                        <button class="flex items-center space-x-1 text-gray-600 hover:text-green-500 transition-colors">
                            <i class="far fa-paper-plane"></i>
                            <span>Bagikan</span>
                        </button>
                    </div>
                </div>

                <div class="comments hidden mt-6 pt-4 border-t space-y-4">
                    <div class="comments-list"></div>
                    <div class="flex space-x-3 mt-4">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-400 to-pink-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <textarea rows="2" placeholder="Tulis dukungan atau saranmu..." class="comment-input w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-transparent resize-none"></textarea>
                            <button onclick="addComment('${story.id}', this)" class="mt-2 bg-primary text-white px-4 py-1 rounded-full text-sm hover:bg-indigo-700 transition-colors">
                                Kirim Dukungan
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Load comments for this story
            loadComments(story.id, article.querySelector('.comments-list'));

            return article;
        }

        // Get time ago string
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) return `${days} hari yang lalu`;
            if (hours > 0) return `${hours} jam yang lalu`;
            if (minutes > 0) return `${minutes} menit yang lalu`;
            return 'Baru saja';
        }

        // Load comments for a story
        function loadComments(storyId, commentsContainer) {
            const commentsRef = ref(database, `comments/${storyId}`);
            onValue(commentsRef, (snapshot) => {
                const data = snapshot.val();
                commentsContainer.innerHTML = '';

                if (data) {
                    const comments = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    })).sort((a, b) => a.timestamp - b.timestamp);

                    comments.forEach(comment => {
                        const commentElement = createCommentElement(comment);
                        commentsContainer.appendChild(commentElement);
                    });
                }
            });
        }

        // Create comment element
        function createCommentElement(comment) {
            const div = document.createElement('div');
            div.className = 'flex space-x-3 fade-in';
            
            const timeAgo = getTimeAgo(comment.timestamp);
            
            div.innerHTML = `
                <div class="w-8 h-8 bg-gradient-to-r from-blue-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-user text-white text-sm"></i>
                </div>
                <div class="flex-1">
                    <p class="text-sm text-gray-700 bg-gray-100 rounded-lg p-3">${comment.content}</p>
                    <p class="text-xs text-gray-500 mt-1">${timeAgo}</p>
                </div>
            `;
            
            return div;
        }

        // Submit story form
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('curhatForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const category = document.getElementById('categorySelect').value;
                const title = document.getElementById('titleInput').value.trim();
                const content = document.getElementById('storyTextarea').value.trim();
                const needsCheckboxes = document.querySelectorAll('.need-checkbox:checked');
                const needs = Array.from(needsCheckboxes).map(cb => cb.value);

                if (!category || !title || !content) {
                    alert('Mohon lengkapi semua field yang wajib diisi.');
                    return;
                }

                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Mengirim...';
                submitBtn.disabled = true;

                try {
                    // Save to Firebase
                    const storiesRef = ref(database, 'stories');
                    await push(storiesRef, {
                        category,
                        title,
                        content,
                        needs,
                        timestamp: serverTimestamp(),
                        likes: 0,
                        commentsCount: 0
                    });

                    // Show success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4 fade-in';
                    successMessage.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span>Ceritamu telah berhasil dibagikan! Terima kasih telah mempercayai kami.</span>
                        </div>
                    `;
                    
                    this.insertBefore(successMessage, this.firstChild);
                    this.reset();
                    
                    // Remove success message after 5 seconds
                    setTimeout(() => {
                        successMessage.remove();
                    }, 5000);

                    // Scroll to stories section
                    setTimeout(() => {
                        document.getElementById('stories').scrollIntoView({ behavior: 'smooth' });
                    }, 1000);

                } catch (error) {
                    console.error('Error saving story:', error);
                    alert('Terjadi kesalahan. Silakan coba lagi.');
                } finally {
                    // Restore button
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });
        });

        // Like story function
        async function likeStory(storyId, button) {
            const heartIcon = button.querySelector('i');
            const likeText = button.querySelector('span');
            const likeCount = button.closest('.story-card').querySelector('.likes-count');
            
            try {
                if (heartIcon.classList.contains('far')) {
                    // Like the story
                    const storyRef = ref(database, `stories/${storyId}/likes`);
                    await push(ref(database, `stories/${storyId}/likes`), serverTimestamp());
                    
                    heartIcon.classList.remove('far');
                    heartIcon.classList.add('fas');
                    button.classList.add('text-red-500');
                    button.classList.remove('text-gray-600');
                    likeText.textContent = 'Didukung';
                    
                    // Add animation
                    heartIcon.style.animation = 'pulse 0.3s ease-in-out';
                    setTimeout(() => {
                        heartIcon.style.animation = '';
                    }, 300);
                } else {
                    // Unlike functionality could be added here
                    // For now, we'll just change the UI back
                    heartIcon.classList.remove('fas');
                    heartIcon.classList.add('far');
                    button.classList.remove('text-red-500');
                    button.classList.add('text-gray-600');
                    likeText.textContent = 'Dukung';
                }
            } catch (error) {
                console.error('Error liking story:', error);
            }
        }

        // Add comment function
        async function addComment(storyId, button) {
            const textarea = button.parentElement.querySelector('.comment-input');
            const commentText = textarea.value.trim();
            
            if (!commentText) return;

            try {
                // Show loading state
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>Mengirim...';
                button.disabled = true;

                // Save comment to Firebase
                const commentsRef = ref(database, `comments/${storyId}`);
                await push(commentsRef, {
                    content: commentText,
                    timestamp: serverTimestamp()
                });

                // Update comments count
                const storyRef = ref(database, `stories/${storyId}/commentsCount`);
                // Note: increment might need to be implemented differently depending on Firebase version
                
                textarea.value = '';
                
                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;

            } catch (error) {
                console.error('Error adding comment:', error);
                button.innerHTML = originalText;
                button.disabled = false;
                alert('Terjadi kesalahan. Silakan coba lagi.');
            }
        }

        // Toggle comments
        function toggleComments(button) {
            const story = button.closest('.story-card');
            const comments = story.querySelector('.comments');
            
            if (comments.classList.contains('hidden')) {
                comments.classList.remove('hidden');
                comments.classList.add('fade-in');
                button.querySelector('span').textContent = 'Tutup';
            } else {
                comments.classList.add('hidden');
                button.querySelector('span').textContent = 'Balas';
            }
        }

        // Filter stories
        function filterStories(category) {
            currentFilter = category;
            
            const buttons = document.querySelectorAll('.filter-btn');
            
            // Update active button
            buttons.forEach(btn => {
                btn.classList.remove('active', 'bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.add('active', 'bg-primary', 'text-white');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            
            // Re-display stories with filter
            displayStories();
        }

        // Update statistics
        function updateStats() {
            // Listen to stories count
            const storiesRef = ref(database, 'stories');
            onValue(storiesRef, (snapshot) => {
                const data = snapshot.val();
                const count = data ? Object.keys(data).length : 0;
                document.getElementById('storyCount').textContent = count.toLocaleString();
            });
        }

        // Show curhat form
        function showCurhatForm() {
            document.getElementById('curhat').scrollIntoView({ behavior: 'smooth' });
        }

        // Scroll to feed
        function scrollToFeed() {
            document.getElementById('stories').scrollIntoView({ behavior: 'smooth' });
        }

        // Load more stories (placeholder)
        function loadMoreStories() {
            // This could be implemented with pagination
            console.log('Load more stories functionality can be added here');
        }

        // Smooth scrolling for navigation
        document.querySelectorAll('nav a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Add intersection observer for animations
        document.addEventListener('DOMContentLoaded', function() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                    }
                });
            }, observerOptions);

            // Observe story cards as they're added
            const feedObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === 1 && node.classList.contains('story-card')) {
                            observer.observe(node);
                        }
                    });
                });
            });

            feedObserver.observe(document.getElementById('storiesFeed'), {
                childList: true
            });
        });
    </script>
</body>
</html>

